swagger: '2.0'
info:
  version: 1.0.0
  title: Token/Token Domain Controller Setup and Maintenance
  description: Token, Token Domain Controller, TRID Setup and Maintenance
  contact:
    name: Authorizations API
    url: 'https://enterprise-confluence.aexp.com/confluence/display/CMSA/CAS+Midrange+-+Servicing+Application+Home'
    email: AuthorizationsAPIs@aexp.com
produces:
  - application/json
consumes:
  - application/json
schemes:
  - https
basePath: /authorizations/v1
tags:
  - name: Token Creation 
  - name: Token Update
  - name: Token Domain Controller Creation 
  - name: Token Domain Controller Update
  - name: Token Domain Controller Delete
  - name: Create TRID
  - name: Update TRID
parameters:
  x-amex-api-consumer:
    name: x-amex-api-consumer
    required: true
    in: header
    format: string
    type: string
    description: This field will be populated by APIGEE, this field will have the requestor of the service This field will be used by API to control the functionality of the service
  token_creation_request:
    name: token_creation_request
    in: body
    description: Token Relation Setup Request
    required: true
    schema:
      $ref: '#/definitions/token_creation_request'
paths:
  '/cards/tokens/creation_details':
    post:
      tags:
        - Token Creation
      summary: Token Creation and Setup  
      description: Token Creation and Setup
      parameters:
        - $ref: '#/parameters/x-amex-api-consumer'
        - $ref: '#/parameters/token_creation_request'        
      responses:
        '201':
          description: Successful Response
          schema:
            $ref: '#/definitions/token_creation_response'
        '400':
          description: Bad Request
                    Funding invalid FSA account
                    Token Account Number not Numeric
                    Token Account length invalid
                    Funding Account Number not Numeric
                    Funding Account length invalid
                    Token Account invalid check digit 
                    Funding Account invalid check digit
                    Invalid version
                    Invalid source of transaction
                    Invalid action code
                    Invalid issue type
                    Invalid crypto key index
                    Invalid Expiration date
                    Invalid Activation Identifier
                    Invalid DPAN Effective date
                    Invalid PROP Token Binrange
                    Invalid GNS Token Binrange
                    Invalid Option
                    Token requestor ID unavailable in CAS
                    Invalid token state
          schema:
            $ref: '#/definitions/error'
        '404':
          description: Not Found
          schema:
            $ref: '#/definitions/error'
        '405':
          description: Method Not Allowed
          schema:
            $ref: '#/definitions/error'
        '406':
          description: Not Acceptable
          schema:
            $ref: '#/definitions/error'
        '415':
          description: Unsupported Media Type
          schema:
            $ref: '#/definitions/error'
        '500':
          description: Internal Server Error
                  Invalid source of transaction          
                  DB error in add          
                  Unable to process                  
          schema:
            $ref: '#/definitions/error'
    put:
      tags:
        - Token Update
      summary: Token Update and Setup 
      description: Token Update and Setup
      parameters:
        - $ref: '#/parameters/x-amex-api-consumer'
        - $ref: '#/parameters/token_creation_request'        
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/token_creation_response'
        '400':
          description: Bad Request
                    Funding invalid FSA account
                    Token Account Number not Numeric
                    Token Account length invalid
                    Funding Account Number not Numeric
                    Funding Account length invalid
                    Token Account invalid check digit 
                    Funding Account invalid check digit
                    Invalid version
                    Invalid source of transaction
                    Invalid action code
                    Invalid issue type
                    Invalid crypto key index
                    Invalid Expiration date
                    Invalid Activation Identifier
                    Invalid DPAN Effective date
                    Invalid PROP Token Binrange
                    Invalid GNS Token Binrange
                    Invalid Option
                    Token requestor ID unavailable in CAS
                    Invalid token state
          schema:
            $ref: '#/definitions/error'
        '404':
          description: Not Found
          schema:
            $ref: '#/definitions/error'
        '405':
          description: Method Not Allowed
          schema:
            $ref: '#/definitions/error'
        '406':
          description: Not Acceptable
          schema:
            $ref: '#/definitions/error'
        '415':
          description: Unsupported Media Type
          schema:
            $ref: '#/definitions/error'
        '500':
          description: Internal Server Error
                  Invalid version
                  Invalid source of transaction
                  DB error in mod  
                  Unable to process                  
          schema:
            $ref: '#/definitions/error'

  '/cards/tokens/domain_details':
    post:
      tags:
        - Token Domain Controller Creation
      summary: Setup Domain Controller  
      description: Domain Controller Setup
      parameters:
        - $ref: '#/parameters/x-amex-api-consumer'
        - name: token_domain_controller_setup_request
          in: body
          description: Token Relation Setup Request
          required: true
          schema:
            $ref: '#/definitions/token_domain_controller_request'         
      responses:
        '201':
          description: Successful response
          schema:
            $ref: '#/definitions/token_dc_creation_response'
        '400':
          description: Bad Request
                    Account Number not Numeric
                    Account length invalid
                    Account invalid check digit 
                    Invalid expiration date
                    Invalid token Effective date
                    Invalid token Binrange
                    Data not found
                    No open preAuth found  
                    Proxy Funding Account not mapped
                    Invalid MCC
                    Unable to process
                    Invalid SE Number
                    Invalid Funding currency 
                    Invalid Max approve allowed
                    Invalid Max decline allowed
                    Invalid token expiration data       
                    Invalid token effect date
                    Invalid check-out date
                    Invalid preauth start date                                    
                    Invalid preauth expiration date
                    Invalid PSL override
          schema:
            $ref: '#/definitions/error'
        '404':
          description: Not Found
          schema:
            $ref: '#/definitions/error'
        '405':
          description: Method Not Allowed
          schema:
            $ref: '#/definitions/error'
        '406':
          description: Not Acceptable
          schema:
            $ref: '#/definitions/error'
        '415':
          description: Unsupported Media Type
          schema:
            $ref: '#/definitions/error'
        '500':
          description: Internal Server Error
                    Database error
                    Invalid source of transaction
                    Unable to process                  
          schema:
            $ref: '#/definitions/error'
    put:
      tags:
        - Token Domain Controller Update
      summary: Domain Controller Update  
      description: Domain Controller Update
      parameters:
        - $ref: '#/parameters/x-amex-api-consumer'
        - name: token_domain_controller_request
          in: body
          description: Token Relation Setup Request
          required: true
          schema:
            $ref: '#/definitions/token_domain_controller_request'         
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/token_dc_creation_response'
        '400':
          description: Bad Request
                    Account Number not Numeric
                    Account length invalid
                    Account invalid check digit 
                    Invalid expiration date
                    Invalid token Effective date
                    Invalid token Binrange
                    Data not found
                    No open preAuth found  
                    Proxy Funding Account not mapped
                    Invalid MCC
                    Unable to process
                    Invalid SE Number
                    Invalid Funding currency 
                    Invalid Max approve allowed
                    Invalid Max decline allowed
                    Invalid token expiration data       
                    Invalid token effect date
                    Invalid check-out date
                    Invalid preauth start date                                    
                    Invalid preauth expiration date
                    Invalid PSL override
          schema:
            $ref: '#/definitions/error'
        '404':
          description: Not Found
          schema:
            $ref: '#/definitions/error'
        '405':
          description: Method Not Allowed
          schema:
            $ref: '#/definitions/error'
        '406':
          description: Not Acceptable
          schema:
            $ref: '#/definitions/error'
        '415':
          description: Unsupported Media Type
          schema:
            $ref: '#/definitions/error'
        '500':
          description: Internal Server Error
                    Database error
                    Invalid source of transaction
                    Unable to process                  
          schema:
            $ref: '#/definitions/error'
    delete:
      tags:
        - Token Domain Controller Delete
      summary: Domain Controller delete  
      description: Domain Controller delete
      parameters:
        - $ref: '#/parameters/x-amex-api-consumer'
        - name: token_domain_controller
          in: body
          description: Token Relation Setup Request
          required: true
          schema:
            $ref: '#/definitions/token_domain_controller'         
      responses:
        '204':
          description: Successful response
        '400':
          description: Bad Request
                    Account Number not Numeric
                    Account length invalid
                    Account invalid check digit 
          schema:
            $ref: '#/definitions/error'
        '404':
          description: Not Found
          schema:
            $ref: '#/definitions/error'
        '405':
          description: Method Not Allowed
          schema:
            $ref: '#/definitions/error'
        '406':
          description: Not Acceptable
          schema:
            $ref: '#/definitions/error'
        '415':
          description: Unsupported Media Type
          schema:
            $ref: '#/definitions/error'
        '500':
          description: Internal Server Error
                    Database error
                    Invalid source of transaction
                    Unable to process                  
          schema:
            $ref: '#/definitions/error'

  '/cards/tokens/requestor_identifier':
    post:
      tags:
        - Create TRID
      summary: Create TRID (Token Requestor Identifier)
      description: Create TRID (Token Requestor Identifier)
      parameters:
        - $ref: '#/parameters/x-amex-api-consumer'
        - name: trid_create_request
          in: body
          description: TRID Addition 
          required: true
          schema:
            $ref: '#/definitions/trid_request'      
      responses:
        '201':
          description: Successful Response
          schema:
            $ref: '#/definitions/trid_response'
        '400':
          description: Bad Request
                    Invalid Token Requestor Id
                    Invalid TRID Merchant Number
                    TRID already Exists
                    Invalid Status code
                    Invalid Activation date
                    Invalid Cancel date
                    Invalid Token Assurance Level number
                    TRID Reason Code Is Mandatory If Status Code Is Suspended Or Canceled
                    Invalid Domain control usage indicator
          schema:
            $ref: '#/definitions/error'
        '404':
          description: Not Found
          schema:
            $ref: '#/definitions/error'
        '405':
          description: Method Not Allowed
          schema:
            $ref: '#/definitions/error'
        '406':
          description: Not Acceptable
          schema:
            $ref: '#/definitions/error'
        '415':
          description: Unsupported Media Type
          schema:
            $ref: '#/definitions/error'
        '500':
          description: Internal Server Error
                  Invalid source of transaction          
                  DB error in add          
                  Unable to process                  
          schema:
            $ref: '#/definitions/error'  
    put:
      tags:
        - Update TRID
      summary: Trid Update
      description: TRID Update
      parameters:
        - $ref: '#/parameters/x-amex-api-consumer'
        - name: trid_update_request
          in: body
          description: TRID Update
          required: true
          schema:
            $ref: '#/definitions/trid_request'      
      responses:
        '200':
          description: Successful Response
          schema:
            $ref: '#/definitions/trid_response'
        '400':
          description: Bad Request
                    Invalid Token Requestor Id
                    Invalid S/E Number
                    NO TRID to change
                    NO TRID to delete
                    Invalid Status code
                    Invalid Activation date
                    Invalid Cancel date
                    Invalid Token Assurance Level number
                    TRID Reason Code Is Mandatory If Status Code Is Suspended Or Canceled
                    Invalid Domain control usage indicator
          schema:
            $ref: '#/definitions/error'
        '404':
          description: Not Found
          schema:
            $ref: '#/definitions/error'
        '405':
          description: Method Not Allowed
          schema:
            $ref: '#/definitions/error'
        '406':
          description: Not Acceptable
          schema:
            $ref: '#/definitions/error'
        '415':
          description: Unsupported Media Type
          schema:
            $ref: '#/definitions/error'
        '500':
          description: Internal Server Error
                  Invalid source of transaction          
                  DB error in add          
                  Unable to process                  
          schema:
            $ref: '#/definitions/error'
            
definitions:
  token_creation_request:
    type: object
    required:
      - payment_token_number
      - funding_card_number
      - wallet_id
      - payment_token_expiry
      - token_requestor_identifier
    properties:
      payment_token_number:
        type: string
        format: string
        minLength: 15
        maxLength: 19
        description: Token Number ->left justified. In C517 this field is Card member number 
      funding_card_number:
        type: string
        format: string
        minLength: 15
        maxLength: 19
        description: Account Number ->left justified
      source_account_number:
        type: string
        format: string
        minLength: 15
        maxLength: 19
        description: Account Number (token on token)->left justified. In C517 this field is associated token number.
      wallet_id:
        type: string
        format: string
        minLength: 2
        maxLength: 2
        description: Alpha-numeric wallet Id. In C517 this field is Wallet provider    
      payment_token_expiry:
        type: string
        format: string
        minLength: 4
        maxLength: 4        
        description: expiry date of funding card.  Format MMyy. In C517 this field is expiration date
      token_reference_identifier:
        type: string
        format: string
        minLength: 1
        maxLength: 41
        description: Alpha-numeric, will be used to refer to the token data during inquiry
      token_requestor_identifier:
        type: string
        format: string
        minLength: 11
        maxLength: 11
        description: Token Requester Identifier
      funding_card_expiry:
        type: string
        format: string
        minLength: 4
        maxLength: 4            
        description: expiry date of funding_card.  Format MMyy. In C517 this field is Expiration date of FPAN
      payment_token_valid_from:
        type: string
        format: string
        minLength: 4
        maxLength: 4            
        description: Token Account Effective date.  Format MMyy.  In C517 this field is DPAN effective date
      derivation_key_index:
        type: number
        format: int32
        maximum: 255
        minimum: 0
        description: Derivation Key Index. Possible values 0-255, 0 - Dynamic value, 1 - 255 Derivation key index.  In C517 this field is Crypto key index.
      funding_card_pan_sequence_number:
        type: string
        maxLength: 2        
        description: FPAN PAN Sequence Number
      secure_element_id:
        type: string
        format: string
        maxLength: 48
        description: Secure element ID (aka  device ID)
      wallet_user_identifier:
        type: string
        format: string
        maxLength: 254
        description: Wallet User Identifier
      device_type:
        type: string
        maxLength: 3         
        description: Device Type
      token_storage_location:
        type: string
        maxLength: 2 
        description: Token Storage location
      activation_identifier:
        type: string
        enum:
          - active
          - inactive
          - activated_by_rep
          - activated_by_device_authentication_performed_by_email_OTP
          - Activated_by_Device_Authentication_Performed_by_SMS_OTP
          - Activated_by_Device_Authentication_Performed_by_Banking_App
          - Activated_with_no_Additional_Authentication_green_flow
      account_id:
        type: string
        maxLength: 224 #need to update?
        description: Account Id, used only by andriod. In C517 this field is wallet ID
      assigned_token_assurance_level:
        type: string
        maxLength: 2 
        description: Assigned Token Assurance Level - Alpha-numeric        
      first_name:  # etv will get back if we need? Also the MAX Length
        type: string
        format: string
        maxLength: 30
      middle_name: # etv will get back if we need? Also the MAX Length
        type: string
        format: string
        maxLength: 30
      last_name: # etv will get back if we need? Also the MAX Length
        type: string
        format: string
        maxLength: 30
      token_par_name:
        type: string
        format: string
        minLength: 29
        maxLength: 29
        example: "A0001234567890123456789012345"
        description: Payment Account Reference number. It is a 29 byte alphanumeric value
  token_domain_controller:
    type: object
    required:
      - account_number
      - account_type
    properties:
      account_type:
        type: string
        enum:
          - global_token_level_control
          - token_level_control
        description: data Number Number ->left justified
      account_number:
        type: string
        format: string
        minLength: 15
        maxLength: 19
        description: data Number Number ->left justified. This field will have 
          - Funding Card Number if account_number is global_token_level_control
          - Token if account_number is token_level_control
  token_domain_controller_request:
    type: object
    required:
      - token_domain_controller
    properties:
      token_domain_controller:
        $ref: '#/definitions/token_domain_controller'
      maintained_by:
        type: string
        format: string
        maxLength: 20
        description: Maintained By
      unique_identifier:
        type: string
        format: string
        maxLength: 15
        description: Unique Identifier ->left justified, blank filled
      maximum_approved_transaction:
        type: integer
        format: int32
        minimum: 1
        maximum: 999
        description: Max number of approved transactions. Range 1-999 
      maximum_declined_transaction:
        type: integer
        format: int32
        minimum: 1
        maximum: 999
        description: Max number of declined transactions. Range 1-999 
      client_defined_amount:
        type: number
        format: double
        description: Amount Client defined and used in the matching criteria.
      client_time_zone:
        type: string
        format: string
        minLength: 3
        maxLength: 80
        description: Time zone of the client. Example - Australia/ACT, America/Phoenix
      domain_control_effective_timestamp:
        type: string
        format: date-time
        description: Mandatory only for POST request. (Always in MST) Format yyyy-MM-ddTHH:mm:ss.SSSZ, eg. 2016-03-20T00:00:23.981-0700 
      domain_control_expiry_timestamp:
        type: string
        format: date-time
        description: Mandatory only for POST request. (Always in MST) Format yyyy-MM-ddTHH:mm:ss.SSSZ, eg. 2016-03-20T00:00:23.981-0700
      domain_control_usage_type:
        type: string
        enum:
          - single_use
          - multiple_authorization
          - travel_pre_auth_refresh
          - refresh_with_reset_on_settlement
          - static_card_data
      low_variance_amount:
        type: number
        format: double
        description: Low Variance Amount
        minimum: 0.00
        maximum: 99999999999.99         
      high_variance_amount:
        type: number
        format: double
        description: High Variance Amount
        minimum: 0.00
        maximum: 99999999999.99         
      low_variance_percentage:
        type: number
        format: double
        minimum: 0.00
        maximum: 100.00        
        description: Low Variance Percentage
      high_variance_percentage:
        type: number
        format: double
        minimum: 0.00
        maximum: 100.00        
        description: High Variance Percentage
      test_limit:
        type: number
        format: double
        minimum: 0.00
        maximum: 99999999999.99         
        description: Test Limit  (Test Amount i.e. any auth attempt below $2 would not require a preauth) - the min auth done to pre validate the card
      fully_settled_percentage:
        type: number
        format: double
        minimum: 0.00
        maximum: 100.00        
      partial_authorization_percentage:
        type: number
        format: double      
        minimum: 0.00
        maximum: 100.00        
      partial_authorization_amount:
        type: number
        format: double
        minimum: 0.00
        maximum: 99999999999.99         
        description: Partial Authorization Amount.  13 digit amount
      days_to_add_for_partial_authorization:
        type: integer
        format: int32
        minimum: 1
        maximum: 999
        description: Days to Add for Partial Authorization
      check_out_date:
        type: string
        format: date-time
        description: (Always in MST) Format yyyy-MM-ddTHH:mm:ss.SSSZ, eg. 2016-03-20T00:00:23.981-0700         
      psl_override_flag:
        type: boolean
        description: preferred supplier list flag        
      mobile_alert_indicator:
        type: boolean      
      evng_enrolled_funding_account_indicator:
        type: boolean            
        description: Enterprise vPayment Next Generation indicator flag
      send_to_efds_indicator:
        type: boolean            
      funding_account_status_indicator:
        type: boolean            
      token_plastic_indicator:
        type: boolean      
      merchant_category_code:
        type: array
        maxItems: 25   
        maxLength: 4
        items: 
          type: string
          format: string
      merchant_number:
        type: array      
        maxItems: 25   
        maxLength: 15
        items: 
          type: string
          format: string
      psl_override_merchant_number:
        type: array
        maxItems: 10
        maxLength: 15
        items:
          type: string
          format: string
        description: Prefered supplier list of merchants          
      accounting_field:
        type: array      
        maxItems: 8   
        maxLength: 40
        items:
          $ref: '#/definitions/data_field'
      user_defined_field:
        type: array      
        maxItems: 12   
        maxLength: 40
        items: 
          $ref: '#/definitions/data_field'
  data_field:
    type: object
    properties:
      item_index:
        type: integer
        format: int32
      data_value:
        type: string
        format: string
  response:
    type: object
    required:
      - payment_token_number
      - decision_text
    properties:
      payment_token_number:
        type: string
        format: string
        minLength: 15
        maxLength: 19
        description: Account Number ->left justified
      decision_text :
        type: string
        format: string
        maxLength: 100
        description: Decision Text      
  token_creation_response:
    type: object
    required:
      - response
      - funding_card_number
    properties:
      response:
          $ref: '#/definitions/response'        
      funding_card_number:
        type: string
        format: string
        minLength: 15
        maxLength: 19
        description: Account Number ->left justified
  token_dc_creation_response:
    type: object
    required:
      - response
      - funding_card_number
      - zip_code
    properties:
      response:
          $ref: '#/definitions/response'        
      funding_card_number:
        type: string
        format: string
        minLength: 15
        maxLength: 19
        description: Account Number ->left justified        
      zip_code:
        type: string
        format: string
        minLength: 10
        maxLength: 15
        description: Funding Card postal code ->left justified        
  trid_request:
    type: object
    required:
      - token_requestor_identifier
      - token_requestor_identifier_status
      - token_requestor_identifier_activation_date
      - domain_controller_token_level_usage_indicator
      - wallet_id
    properties:
      token_requestor_identifier:
        type: string
        format: string
        maxLength: 11
        minLength: 11
        description: Token Requester Identifier
      token_requestor_identifier_status:
        type: string
        enum: 
          - active
          - suspend
          - cancel
        description: Token Requester Identifier
      token_requestor_identifier_activation_date:
        type: string
        format: date
        description: Token requestor ID activation date.  Format yyyy-MM-dd
      wallet_id:
        type: string
        format: string
        minLength: 2
        maxLength: 2
        description: Alpha-numeric wallet Id
      domain_controller_token_level_usage_indicator:
        type: string
        enum: 
          - mandatory
          - optional
          - prohibited
        description: Token level Domain control usage indicator
      product_name:
        type: string
        format: string
        maxLength: 35 
      partner_name:
        type: string
        format: string
        maxLength: 35
      trid_merchant_number:  
        type: array      
        maxItems: 200
        maxLength: 15
        items: 
          type: string
          format: string
  trid_response:
    type: object
    required:
      - token_requestor_identifier
    properties:
      token_requestor_identifier:
        type: string
        format: string
        maxLength: 11
        minLength: 11
        description: Token Requester Identifier
  error:
    type: object
    properties:
      error_cd:
        type: string
        format: string
      error_msg:
        type: string
        format: string
